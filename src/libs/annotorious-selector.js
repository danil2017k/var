/*! For license information please see annotorious-selector-pack.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Annotorious=t():(e.Annotorious=e.Annotorious||{},e.Annotorious.SelectorPack=t())}(self,(function(){return(()=>{var e={94:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}e.exports=function e(n,r){if(n===r)return!0;if(n&&r&&"object"==t(n)&&"object"==t(r)){if(n.constructor!==r.constructor)return!1;var o,i,a;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!e(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(a=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,a[i]))return!1;for(i=o;0!=i--;){var u=a[i];if(!e(n[u],r[u]))return!1}return!0}return n!=n&&r!=r}},773:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,a=r.length;i<a;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";n.d(r,{default:()=>dr});var e,t=n(773),o=n.n(t),i="http://www.w3.org/2000/svg",a=function(e,t){var n=function(e){var t=e.getAttribute("class");return t?new Set(t.split(" ")):new Set}(e);n.add(t),e.setAttribute("class",Array.from(n).join(" "))},u=new Uint8Array(16);function c(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(u)}const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&l.test(e)};for(var f=[],p=0;p<256;++p)f.push((p+256).toString(16).substr(1));const b=function(e,t,n){var r=(e=e||{}).random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var y=n(94),d=n.n(y);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,"clone",(function(t,n){return new e(g(g({},r.underlying),t),g(g({},r.opts),n))})),v(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),this.underlying=t,this.opts=n}var t,n;return t=e,(n=[{key:"isEqual",value:function(e){return"Annotation"===(null==e?void 0:e.type)&&(this.underlying===e.underlying||!(!this.underlying.id||!e.underlying.id)&&d()(this.underlying,e.underlying))}},{key:"readOnly",get:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(e){this.underlying.body=e}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"start",get:function(){return this.selector("TextPositionSelector").start}},{key:"end",get:function(){return this.selector("TextPositionSelector").end}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}v(w,"create",(function(e){var t={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(b()),body:[]};return new w(g(g({},t),e))}));var A=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"clone",(function(t){var n=new e;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),t&&(n.underlying=S(S({},n.underlying),t)),n})),P(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),P(this,"toAnnotation",(function(){var e=Object.assign({},r.underlying,{"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(b())});return new w(e)})),this.underlying={type:"Selection",body:n||[],target:t}}var t,n;return t=e,(n=[{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(e){return!!e&&d()(this.underlying,e.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"isSelection",get:function(){return!0}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D(e);if(t){var o=D(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return G(this,n)}}function G(e,t){if(t&&("object"===E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L="An implementation is missing",H="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,B=function(e){M(n,e);var t=_(n);function n(e,r,o){var a;x(this,n),N(T(a=t.call(this)),"enableResponsive",(function(){window.ResizeObserver&&(a.resizeObserver=new ResizeObserver((function(){var e=a.svg.getBoundingClientRect(),t=a.svg.viewBox.baseVal,n=t.width,r=t.height;a.scale=Math.max(n/e.width,r/e.height),a.onScaleChanged&&a.onScaleChanged(a.scale)})),a.resizeObserver.observe(a.svg.parentNode))})),N(T(a),"getSVGPoint",(function(e){var t=a.svg.createSVGPoint();if(H){var n=a.svg.getBoundingClientRect(),r=e.clientX-n.x,o=e.clientY-n.y,i=a.svg.getBoundingClientRect(),u=i.left,c=i.top;return t.x=r+u,t.y=o+c,t.matrixTransform(a.g.getScreenCTM().inverse())}return t.x=e.offsetX,t.y=e.offsetY,t.matrixTransform(a.g.getCTM().inverse())})),N(T(a),"drawHandle",(function(e,t){var n=document.createElementNS(i,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(i,"g"),o=function(n){var r=document.createElementNS(i,"circle");return r.setAttribute("cx",e),r.setAttribute("cy",t),r.setAttribute("r",n),r},u=a.config.handleRadius||6,c=o(u);c.setAttribute("class","a9s-handle-inner");var l=o(u+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),N(T(a),"setHandleXY",(function(e,t,n){var r=e.querySelector(".a9s-handle-inner");r.setAttribute("cx",t),r.setAttribute("cy",n);var o=e.querySelector(".a9s-handle-outer");o.setAttribute("cx",t),o.setAttribute("cy",n)})),N(T(a),"getHandleXY",(function(e){var t=e.querySelector(".a9s-handle-outer");return{x:parseFloat(t.getAttribute("cx")),y:parseFloat(t.getAttribute("cy"))}})),N(T(a),"scaleHandle",(function(e){var t=e.querySelector(".a9s-handle-inner"),n=e.querySelector(".a9s-handle-outer"),r=a.scale*(a.config.handleRadius||6);t.setAttribute("r",r),n.setAttribute("r",r)})),a.svg=e.closest("svg"),a.g=e,a.config=r,a.env=o,a.scale=1;var u=o.image;return(u instanceof Element||u instanceof HTMLDocument)&&a.enableResponsive(),a}return C(n,[{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}]),n}(o()),U=function(e){M(n,e);var t=_(n);function n(e,r,o){var i;return x(this,n),N(T(i=t.call(this,e,r,o)),"attachListeners",(function(e){var t=e.mouseMove,n=e.mouseUp,r=e.dblClick;t&&(i.mouseMove=function(e){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.started||(i.emit("startSelection",{x:r,y:o}),i.started=!0),t(r,o,e)},i.svg.addEventListener("mousemove",i.mouseMove)),n&&(i.mouseUp=function(e){if(0===e.button){var t=i.getSVGPoint(e),r=t.x,o=t.y;n(r,o,e)}},document.addEventListener("mouseup",i.mouseUp)),r&&(i.dblClick=function(e){var t=i.getSVGPoint(e),n=t.x,o=t.y;r(n,o,e)},document.addEventListener("dblclick",i.dblClick))})),N(T(i),"detachListeners",(function(){i.mouseMove&&i.svg.removeEventListener("mousemove",i.mouseMove),i.mouseUp&&document.removeEventListener("mouseup",i.mouseUp),i.dblClick&&document.removeEventListener("dblclick",i.dblClick)})),N(T(i),"start",(function(e,t){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.startDrawing(r,o,t,e)})),N(T(i),"startDrawing",(function(e){throw new Error(L)})),N(T(i),"createEditableShape",(function(e){throw new Error(L)})),i.started=!1,i}return C(n,[{key:"isDrawing",get:function(){throw new Error(L)}}]),n}(B);function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Y(e,t)}function V(e,t){if(t&&("object"===X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}U.supports=function(e){throw new Error(L)};var I="An implementation is missing",W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(r);if(o){var n=z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return V(this,e)});function a(e,t,n,r){var o,u,c,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),l=function(e){throw new Error(I)},(c="updateState")in(u=F(o=i.call(this,t,n,r)))?Object.defineProperty(u,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[c]=l,o.annotation=e,o}return t=a,(n=[{key:"element",get:function(){throw new Error(I)}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Z=function(e,t){var n=e.selector("FragmentSelector");if(null!=n&&n.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){var r=n.value,o=r.includes(":")?r.substring(r.indexOf("=")+1,r.indexOf(":")):"pixel",i=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((r.includes(":")?r.substring(r.indexOf(":")+1):r.substring(r.indexOf("=")+1)).split(",").map(parseFloat),4),a=i[0],u=i[1],c=i[2],l=i[3];return"percent"===o.toLowerCase()&&(a=a*t.naturalWidth/100,u=u*t.naturalHeight/100,c=c*t.naturalWidth/100,l=l*t.naturalHeight/100),{x:a,y:u,w:c,h:l}}};function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee=function(e,t,n,r){return J(J({},function(e,t,n,r,o,i){return"percent"===(null==i?void 0:i.toLowerCase())?function(e,t,n,r,o){var i=e/o.naturalWidth*100,a=t/o.naturalHeight*100,u=0/o.naturalWidth*100,c=0/o.naturalHeight*100;return{source:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=percent:".concat(i,",").concat(a,",").concat(u,",").concat(c)}}}(e,t,0,0,o):function(e,t,n,r,o){return{source:null==o?void 0:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(e,",").concat(t,",").concat(0,",").concat(0)}}}(e,t,0,0,o)}(e,t,0,0,n,r)),{},{renderedVia:{name:"point"}})};function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(){return re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=oe(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},re.apply(this,arguments)}function oe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ce(e)););return e}function ie(e,t){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ie(e,t)}function ae(e,t){if(t&&("object"===te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ue(e)}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ce(r);if(o){var n=ce(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ae(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),le(ue(o=a.call(this,e,t,n,r)),"onScaleChanged",(function(){return o.scaleHandle(o.point)})),le(ue(o),"onGrab",(function(){o.isGrabbed=!0})),le(ue(o),"onMouseMove",(function(e){if(0===e.button&&o.isGrabbed){var t=o.getSVGPoint(e),n=t.x,r=t.y;o.setHandleXY(o.point,n,r);var i=ee(n,r,o.env.image,o.config.fragmentUnit);o.emit("update",i)}})),le(ue(o),"onMouseUp",(function(){o.isGrabbed=!1})),le(ue(o),"updateState",(function(e){var t=Z(e,o.env.image),n=t.x,r=t.y;o.setHandleXY(o.point,n,r)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp);var c=Z(e,r.image),l=c.x,s=c.y;return o.container=document.createElementNS(i,"g"),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.point=o.drawHandle(l,s),o.point.addEventListener("mousedown",o.onGrab),o.elementGroup.appendChild(o.point),o.container.appendChild(o.elementGroup),t.appendChild(o.container),o.isGrabbed=!1,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),re(ce(u.prototype),"destroy",this).call(this)}}])&&ne(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(W);function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},be(e,t)}function ye(e,t){if(t&&("object"===fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return de(e)}function de(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},he(e)}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var me=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&be(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=he(r);if(o){var n=he(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ye(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),ge(de(r=i.call(this,e,t,n)),"startDrawing",(function(e,t,n,o){var i,a=null===(i=o.target.closest(".a9s-annotation"))||void 0===i?void 0:i.annotation;if(a&&function(e){var t;return"point"===(null===(t=e.target.renderedVia)||void 0===t?void 0:t.name)}(a))r.emit("cancel");else{var u=r.drawHandle(e,t);r.scaleHandle(u),r.g.appendChild(u),u.annotation=new A(ee(e,t,r.env.image,r.config.fragmentUnit)),r.emit("complete",u)}})),ge(de(r),"stop",(function(){})),ge(de(r),"createEditableShape",(function(e){return new se(e,r.g,r.config,r.env)})),r}return t=a,(n=[{key:"isDrawing",get:function(){return!1}}])&&pe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);me.identifier="point",me.supports=function(e){return!1};var ve=function(e){var t=function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(e){return e.parentNode.removeChild(e)})),t(e),Array.from(e.querySelectorAll("*")).forEach(t),e},we=function(e){var t,n,r=e.selector("SvgSelector");if(r){var o=new DOMParser,a=r.value,u=o.parseFromString(a,"image/svg+xml"),c=u.lookupPrefix(i),l=u.lookupNamespaceURI(null);return c||l?ve(u).firstChild:ve((t=u,n=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",'<svg xmlns="'.concat(i,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},Oe=function(e){var t=we(e),n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},Se=function(e,t){var n=e.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(i,'"'),""),{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}},je=function(e,t,n,r){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("r",r)},Pe=function(e,t,n,r){var o=e.querySelector(".a9s-inner"),i=e.querySelector(".a9s-outer");je(o,t,n,r),je(i,t,n,r)},Ae=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),r:parseFloat(t.getAttribute("r"))}};function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ke=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xe(this,"redraw",(function(){var e=Ae(r.circle),t=e.cx,n=e.cy,o=e.r,i=t+o>r.w?r.w-o:t,a=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(a," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),xe(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=n;var o=Ae(this.circle),a=o.cx,u=o.cy,c=o.r,l=a+c>this.w?this.w-c:a,s=u+c>this.h?this.h-c:u+c;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&Ee(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Re=function(){function e(t,n,r,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Me(this,"dragTo",(function(e,t){var n=a.env.image,r=n.naturalWidth,o=n.naturalHeight;a.group.style.display=null;var i=e-a.anchor[0],u=t-a.anchor[1],c=Math.max(1,Math.pow(Math.pow(i,2)+Math.pow(u,2),.5)/2),l=a.anchor[0]+i/2,s=a.anchor[1]+u/2;l-c<0||l+c>r||s-c<0||s+c>o||(Pe(a.circle,l,s,c),a.mask.redraw())})),Me(this,"getBoundingClientRect",(function(){return a.circle.getBoundingClientRect()})),Me(this,"toSelection",(function(){return new A(Se(a.group,a.env.image))})),Me(this,"destroy",(function(){a.group.parentNode.removeChild(a.group),a.mask=null,a.circle=null,a.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.circle=function(e,t,n){var r=document.createElementNS(i,"g"),o=document.createElementNS(i,"circle"),a=document.createElementNS(i,"circle");return a.setAttribute("class","a9s-inner"),je(a,e,t,2),o.setAttribute("class","a9s-outer"),je(o,e,t,2),r.appendChild(o),r.appendChild(a),r}(t,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new ke(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.circle}}])&&Ce(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),_e=/firefox/i.test(navigator.userAgent),Ge=function(e,t,n,r,o){e.setAttribute("width",r),e.setAttribute("height",o),_e?(e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("transform","translate(".concat(t,", ").concat(n,")"))):(e.setAttribute("x",t),e.setAttribute("y",n))},Te=function(e,t){var n=t.getBBox(),r=n.x,o=n.y,a=n.width,u=n.height,c=document.createElementNS(i,"svg");c.setAttribute("class","a9s-formatter-el"),Ge(c,r,o,a,u);var l=document.createElementNS(i,"g");l.appendChild(e),c.appendChild(l),t.append(c)},De=function(e,t,n){if(!n)return e;var r=n(t);if(!r)return e;if("string"==typeof r||r instanceof String)a(e,r);else if(r.nodeType===Node.ELEMENT_NODE)Te(r,e);else{var o=r.className,i=r.style,u=r.element;if(o&&a(e,o),i){var c=e.querySelector(".a9s-outer"),l=e.querySelector(".a9s-inner");c&&l?(c.setAttribute("style","display:none"),l.setAttribute("style",i)):e.setAttribute("style",i)}for(var s in u&&Te(u,e),r)r.hasOwnProperty(s)&&s.startsWith("data-")&&e.setAttribute(s,r[s])}},Ne=function(e,t,n,r,o){var i=e.querySelector(".a9s-formatter-el");i&&Ge(i,t,n,r,o)};function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function He(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xe(){return Xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=qe(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Xe.apply(this,arguments)}function qe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ze(e)););return e}function Ye(e,t){return Ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ye(e,t)}function Ve(e,t){if(t&&("object"===Le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Fe(e)}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(e)}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var We=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ye(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ze(r);if(o){var n=ze(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ve(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Ie(Fe(o=a.call(this,e,t,n,r)),"setSize",(function(e,t,n){Pe(o.circle,e,t,n),o.mask.redraw(),Ne(o.elementGroup,e,t,n,n);var r=He(o.handles,4),i=r[0],a=r[1],u=r[2],c=r[3];o.setHandleXY(i,e,t-n),o.setHandleXY(a,e+n,t),o.setHandleXY(u,e,t+n),o.setHandleXY(c,e-n,t)})),Ie(Fe(o),"stretchCorners",(function(e,t,n){var r,i=o.getHandleXY(t),a=n.x,u=n.y,c=0,l=0;0==e||2==e?(a=i.x,l=u-i.y,r=Math.abs(l)/2):(u=i.y,c=a-i.x,r=Math.abs(c)/2);var s=c>0?i.x:a,f=l>0?i.y:u,p=s+Math.abs(c)/2,b=f+Math.abs(l)/2;if(Pe(o.circle,p,b,r),o.mask.redraw(),Ne(o.elementGroup,p,b,r,r),0==e||2==e){var y=0,d=2;(0==e&&l>0||2==e&&l<0)&&(y=2,d=0),o.setHandleXY(o.handles[y],p,b-r),o.setHandleXY(o.handles[d],p,b+r),o.setHandleXY(o.handles[1],p+r,b),o.setHandleXY(o.handles[3],p-r,b)}else{var h=3,g=1;(1==e&&c>0||3==e&&c<0)&&(h=1,g=3),o.setHandleXY(o.handles[h],p+r,b),o.setHandleXY(o.handles[g],p-r,b),o.setHandleXY(o.handles[0],p,b-r),o.setHandleXY(o.handles[2],p,b+r)}})),Ie(Fe(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=Ae(o.circle),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),Ie(Fe(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.circle){var r=Ae(o.circle).r,i=o.env.image,a=i.naturalWidth,u=i.naturalHeight,c=Math.max(t(n.x-o.grabbedAt.x,a-r),r),l=Math.max(t(n.y-o.grabbedAt.y,u-r),r);o.setSize(c,l,r),o.emit("update",Se(o.circle,o.env.image))}else{var s=o.handles.indexOf(o.grabbedElem),f=s<2?o.handles[s+2]:o.handles[s-2];o.stretchCorners(s,f,n),o.emit("update",Se(o.circle,o.env.image))}}})),Ie(Fe(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Ie(Fe(o),"onScaleChanged",(function(e){return o.handles.map(o.scaleHandle)})),Ie(Fe(o),"updateState",(function(e){var t=we(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("r"));o.setSize(n,r,i)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.circle=Oe(e),o.circle.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.circle)),o.mask=new ke(r.image,o.circle),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.circle);var c=Ae(o.circle),l=c.cx,s=c.cy,f=c.r;return o.handles=[[l,s-f],[l+f,s],[l,s+f],[l-f,s]].map((function(e){var t=He(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),De(o.circle,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),Xe(ze(u.prototype),"destroy",this).call(this)}}])&&Ue(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(W);function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ke(e,t){return Ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ke(e,t)}function Je(e,t){if(t&&("object"===$e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Qe(e)}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function et(e){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(e)}function tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ke(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=et(r);if(o){var n=et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Je(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),tt(Qe(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Re(e,t,r.g,r.env)})),tt(Qe(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),tt(Qe(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),tt(Qe(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),tt(Qe(r),"createEditableShape",(function(e){return new We(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&Ze(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);nt.identifier="circle",nt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<circle/g)};var rt=function(e,t,n,r,o){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("rx",r),e.setAttribute("ry",o)},ot=function(e,t,n,r,o){var i=e.querySelector(".a9s-inner"),a=e.querySelector(".a9s-outer");rt(i,t,n,r,o),rt(a,t,n,r,o)},it=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),rx:parseFloat(t.getAttribute("rx")),ry:parseFloat(t.getAttribute("ry"))}};function at(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ct=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ut(this,"redraw",(function(){var e=it(r.ellipse),t=e.cx,n=e.cy,o=e.rx,i=e.ry,a=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(t," ").concat(a," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),ut(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=n;var o=it(this.ellipse),a=o.cx,u=o.cy,c=o.rx,l=o.ry,s=u+l;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(a," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&at(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ft=function(){function e(t,n,r,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),st(this,"dragTo",(function(e,t){a.group.style.display=null;var n=e-a.anchor[0],r=t-a.anchor[1],o=n>0?a.anchor[0]+n/2:e+n/2,i=r>0?a.anchor[1]+r/2:t+r/2,u=Math.abs(n/2),c=Math.abs(r/2);ot(a.ellipse,o,i,u,c),a.mask.redraw()})),st(this,"getBoundingClientRect",(function(){return a.ellipse.getBoundingClientRect()})),st(this,"toSelection",(function(){return new A(Se(a.group,a.env.image))})),st(this,"destroy",(function(){a.group.parentNode.removeChild(a.group),a.mask=null,a.ellipse=null,a.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(i,"g"),this.ellipse=function(e,t,n,r){var o=document.createElementNS(i,"g"),a=document.createElementNS(i,"ellipse"),u=document.createElementNS(i,"ellipse");return a.setAttribute("class","a9s-inner"),rt(a,e,t,2,r),u.setAttribute("class","a9s-outer"),rt(u,e,t,2,r),o.appendChild(u),o.appendChild(a),o}(t,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new ct(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.ellipse}}])&&lt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pt(e){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(e)}function bt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ht(){return ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=gt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ht.apply(this,arguments)}function gt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ot(e)););return e}function mt(e,t){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mt(e,t)}function vt(e,t){if(t&&("object"===pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return wt(e)}function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ot(e){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ot(e)}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mt(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ot(r);if(o){var n=Ot(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return vt(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),St(wt(o=a.call(this,e,t,n,r)),"setSize",(function(e,t,n,r){ot(o.ellipse,e,t,n,r),o.mask.redraw(),Ne(o.elementGroup,e,t,n,r);var i=bt(o.handles,4),a=i[0],u=i[1],c=i[2],l=i[3];o.setHandleXY(a,e,t-r),o.setHandleXY(u,e+n,t),o.setHandleXY(c,e,t+r),o.setHandleXY(l,e-n,t)})),St(wt(o),"stretchCorners",(function(e,t,n,r){var i=o.getHandleXY(t),a=o.getHandleXY(n),u=r.x,c=r.y,l=0,s=0;0==e||2==e?u=i.x:c=i.y;var f=u-i.x,p=c-i.y,b=f>0?i.x:u,y=p>0?i.y:c,d=Math.abs(f),h=Math.abs(p),g=b+d/2,m=y+h/2;if(l=d/2,s=h/2,0==e||2==e?l=Math.abs(i.x-a.x):s=Math.abs(i.y-a.y),ot(o.ellipse,g,m,l,s),o.mask.redraw(),Ne(o.elementGroup,g,m,l,s),0==e||2==e){var v=0,w=2;(0==e&&p>0||2==e&&p<0)&&(v=2,w=0),o.setHandleXY(o.handles[v],g,m-s),o.setHandleXY(o.handles[w],g,m+s),o.setHandleXY(o.handles[1],g+l,m),o.setHandleXY(o.handles[3],g-l,m)}else{var O=3,S=1;(1==e&&f>0||3==e&&f<0)&&(O=1,S=3),o.setHandleXY(o.handles[O],g+l,m),o.setHandleXY(o.handles[S],g-l,m),o.setHandleXY(o.handles[0],g,m-s),o.setHandleXY(o.handles[2],g,m+s)}})),St(wt(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=it(o.ellipse),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),St(wt(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.ellipse){var r=it(o.ellipse),i=r.rx,a=r.ry,u=o.env.image,c=u.naturalWidth,l=u.naturalHeight,s=t(n.x-o.grabbedAt.x,c-i),f=t(n.y-o.grabbedAt.y,l-a);o.setSize(s,f,i,a),o.emit("update",Se(o.ellipse,o.env.image))}else{var p=o.handles.indexOf(o.grabbedElem),b=p<2?o.handles[p+2]:o.handles[p-2],y=o.handles[(p+3)%4];o.stretchCorners(p,b,y,n),o.emit("update",Se(o.ellipse,o.env.image))}}})),St(wt(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),St(wt(o),"onScaleChanged",(function(e){return o.handles.map(o.scaleHandle)})),St(wt(o),"updateState",(function(e){var t=we(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("rx")),a=parseFloat(t.getAttribute("ry"));o.setSize(n,r,i,a)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.ellipse=Oe(e),o.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.ellipse)),o.mask=new ct(r.image,o.ellipse),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.ellipse);var c=it(o.ellipse),l=c.cx,s=c.cy,f=c.rx,p=c.ry;return o.handles=[[l,s-p],[l+f,s],[l,s+p],[l-f,s]].map((function(e){var t=bt(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),De(o.ellipse,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),ht(Ot(u.prototype),"destroy",this).call(this)}}])&&dt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(W);function Pt(e){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pt(e)}function At(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t){return Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Et(e,t)}function xt(e,t){if(t&&("object"===Pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return kt(e)}function kt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ct(e){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ct(e)}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Et(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ct(r);if(o){var n=Ct(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return xt(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Mt(kt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new ft(e,t,r.g,r.env)})),Mt(kt(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Mt(kt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),Mt(kt(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),Mt(kt(r),"createEditableShape",(function(e){return new jt(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&At(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Rt.identifier="ellipse",Rt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<ellipse/g)};var Dt=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Tt(this,"setPoints",(function(e){var t=e.map((function(e){return"L".concat(e[0]," ").concat(e[1])})).join(" ");t="M"+t.substring(1),o.outer.setAttribute("d",t),o.inner.setAttribute("d",t)})),Tt(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Tt(this,"dragTo",(function(e){o.group.style.display=null,o.addPoint(e)})),Tt(this,"addPoint",(function(e){var t;o.points=[].concat(function(e){if(Array.isArray(e))return _t(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]),o.setPoints(o.points)})),Tt(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),Tt(this,"toSelection",(function(){return new A(Se(o.group,o.env.image))})),this.points=[t],this.env=r,this.group=document.createElementNS(i,"g"),this.freehand=document.createElementNS(i,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.freehand}}])&&Gt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function Lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e,t){return Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ht(e,t)}function Bt(e,t){if(t&&("object"===Nt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ut(e)}function Ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(){return Xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=qt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Xt.apply(this,arguments)}function qt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Yt(e)););return e}function Yt(e){return Yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Yt(e)}function Vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ft=function(e){var t=e.getAttribute("d").split("L"),n=[];if(t.length>0){var r=t[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<t.length;o++)r=t[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},zt=function(e){return e.querySelector(".a9s-inner").getBBox()},It=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ht(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Yt(r);if(o){var n=Yt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Bt(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Vt(Ut(c=a.call(this,e,t,n,r)),"setPoints",(function(e){var t=function(e){return Math.round(10*e)/10},n=e.map((function(e){return"L".concat(t(e.x)," ").concat(t(e.y))})).join(" ");n="M"+n.substring(1),c.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=c.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,a=o.y,u=o.width,l=o.height;Ne(c.elementGroup,i,a,u,l)})),Vt(Ut(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),Vt(Ut(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e),r=zt(c.shape),o=r.x,i=r.y,a=r.width,u=r.height;if(c.grabbedElem===c.shape){var l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-a),b=t(i,n.y-c.grabbedAt.y,f-u),y=c.shape.querySelector(".a9s-inner"),d=Ft(y).map((function(e){return{x:e.x+p,y:e.y+b}}));c.grabbedAt=n,c.setPoints(d),c.emit("update",Se(c.shape,c.env.image))}}})),Vt(Ut(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),Vt(Ut(c),"updateState",(function(e){var t=Ft(we(e));c.setPoints(t)})),Vt(Ut(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Xt((o=Ut(c),Yt(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=Oe(e),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),De(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var l=zt(c.shape);return l.x,l.y,l.width,l.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&Lt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(W);function Wt(e){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wt(e)}function $t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zt(e,t){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zt(e,t)}function Kt(e,t){if(t&&("object"===Wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Jt(e)}function Jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qt(e){return Qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qt(e)}function en(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qt(r);if(o){var n=Qt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Kt(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),en(Jt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new Dt([e,t],r.g,r.env)})),en(Jt(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),en(Jt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),en(Jt(r),"onMouseUp",(function(e,t){r.onDblClick(e,t)})),en(Jt(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]),r.detachListeners();var n=r.rubberband.getBoundingClientRect(),o=n.width,i=n.height,a=r.config.minSelectionWidth||4,u=r.config.minSelectionHeight||4;if(o>=a||i>=u){var c=r.rubberband.element;c.annotation=r.rubberband.toSelection(),r.emit("complete",c)}else r.emit("cancel");r.stop()})),en(Jt(r),"createEditableShape",(function(e){return new It(e,r.g,r.config,r.env)})),r._isDrawing=!1,r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&$t(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);function nn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}tn.identifier="freehand",tn.supports=function(e){var t=e.selector("SvgSelector");if(t)return t.value.match(/^<svg.*<path*/g)&&!t.value.toUpperCase().includes("Z")};var on=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),rn(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.polygon.getAttribute("points")," z"))})),rn(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.polygon=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.polygon.getAttribute("points")," z"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&nn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function an(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?an(Object(n),!0).forEach((function(t){bn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):an(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cn(e){return function(e){if(Array.isArray(e))return fn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||sn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ln(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=sn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function sn(e,t){if(e){if("string"==typeof e)return fn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fn(e,t):void 0}}function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var yn=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),bn(this,"setPoints",(function(e){var t,n="",r=ln(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a="";if(i.length>0){var u,c=ln(i);try{for(c.s();!(u=c.n()).done;){var l=u.value;l&&(a+=""===a?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(e){c.e(e)}finally{c.f()}n+=a}}}catch(e){r.e(e)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),bn(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),bn(this,"dragTo",(function(e){o.group.style.display=null;var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(cn(t),[e,t[0]]);n.push(r),o.setPoints(n),o.mask.redraw()})),bn(this,"addPoint",(function(e){if(o.points[o.points.length-1].length>0){var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=t[t.length-1];Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(cn(t),[e,t[0]]),o.setPoints(o.points),o.mask.redraw())}else o.points[o.points.length-1]=[e,e],o.setPoints(o.points)})),bn(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),bn(this,"newPart",(function(){o.points.push([])})),bn(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),bn(this,"toSelection",(function(){return new A(un(un({},Se(o.group,o.env.image)),{},{renderedVia:{name:"multipolygon"}}))})),this.points=[],this.points.push([t,t]),this.env=r,this.group=document.createElementNS(i,"g"),this.multipolygon=document.createElementNS(i,"g"),this.multipolygon.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new on(r.image,this.inner),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.multipolygon),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.multipolygon}}])&&pn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hn(Object(n),!0).forEach((function(t){An(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vn(e,t){return vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vn(e,t)}function wn(e,t){if(t&&("object"===dn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return On(e)}function On(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sn(){return Sn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=jn(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Sn.apply(this,arguments)}function jn(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pn(e)););return e}function Pn(e){return Pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pn(e)}function An(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function En(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return xn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function xn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var kn=function(e){var t,n=[],r=En(Cn(e.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(t=r.n()).done;){var o,i=t.value,a=[],u=En(i);try{for(u.s();!(o=u.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};a.push(l)}}catch(e){u.e(e)}finally{u.f()}n.push(a)}}catch(e){r.e(e)}finally{r.f()}return n},Cn=function(e){var t=e.split("M"),n=[];return t.forEach((function(e,t){if(e.length>0){var r=[];(e=(e=(e=(e=(e=e.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(e,t){r.push([parseFloat(e.split(",")[0]).toFixed(2).toString(),parseFloat(e.split(",")[1]).toFixed(2).toString()])})),r[0]!==r[r.length-1]&&r.push(r[0]),n.push(r)}})),n},Mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vn(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pn(r);if(o){var n=Pn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return wn(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),An(On(c=a.call(this,e,t,n,r)),"setPoints",(function(e){var t,n=function(e){return Math.round(10*e)/10},r="",o=En(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r+="M";var a,u=!0,l=En(i);try{for(l.s();!(a=l.n()).done;){var s=a.value;u?(u=!1,r+=s.x.toString()+","+s.y.toString()):r+=" L"+n(s.x).toString()+","+n(s.y).toString()}}catch(e){l.e(e)}finally{l.f()}r+=" Z"}}catch(e){o.e(e)}finally{o.f()}c.shape.querySelector(".a9s-inner").setAttribute("d",r);var f=c.shape.querySelector(".a9s-outer");f.setAttribute("d",r);var p=f.getBBox(),b=p.x,y=p.y,d=p.width,h=p.height;Ne(c.elementGroup,b,y,d,h)})),An(On(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),An(On(c),"onMouseMove",(function(e){var t;c.grabbedElem&&(t=c.getSVGPoint(e),c.grabbedElem===c.shape?function(){var e,n=t.x-c.grabbedAt.x,r=t.y-c.grabbedAt.y,o=[],i=En(kn(c.shape));try{for(i.s();!(e=i.n()).done;){var a=e.value;o.push(a.map((function(e){return{x:e.x+n,y:e.y+r}})))}}catch(e){i.e(e)}finally{i.f()}c.grabbedAt=t,c.setPoints(o);for(var u=0,l=0,s=o;l<s.length;l++)s[l].forEach((function(e,t){void 0!==c.handles[u][t]&&c.setHandleXY(c.handles[u][t],e.x,e.y)})),u+=1;c.emit("update",gn(gn({},Se(c.shape,c.env.image)),{},{renderedVia:{name:"multipolygon"}}))}():function(){var e,n=-1,r=0,o=!1,i=En(c.handles);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.indexOf(c.grabbedElem)>0?(n=a.indexOf(c.grabbedElem),o=!0):o||(r+=1)}}catch(e){i.e(e)}finally{i.f()}var u,l=kn(c.shape),s=[],f=0,p=En(l);try{for(p.s();!(u=p.n()).done;){var b=u.value;f===r?function(){var e=[];b.forEach((function(r,o){o===n?e.push(t):e.push(r)})),s.push(e)}():s.push(b),f+=1}}catch(e){p.e(e)}finally{p.f()}c.setPoints(s),f=0;var y,d=En(c.handles);try{for(d.s();!(y=d.n()).done;){var h=y.value;f===r&&c.setHandleXY(h[n],t.x,t.y),f+=1}}catch(e){d.e(e)}finally{d.f()}c.emit("update",gn(gn({},Se(c.shape,c.env.image)),{},{renderedVia:{name:"multipolygon"}}))}())})),An(On(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),An(On(c),"updateState",(function(e){var t=kn(we(e));c.setPoints(t)})),An(On(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Sn((o=On(c),Pn(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=function(e){var t=we(e);!function(e){var t=we(e).getAttribute("d");Cn(t)}(e);var n=document.createElementNS(i,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n}(e),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape);var l=kn(c.shape);c.handles=[];var s,f=En(l);try{for(f.s();!(s=f.n()).done;){var p=s.value;c.handles.push(p.map((function(e){var t=c.drawHandle(e.x,e.y);return t.addEventListener("mousedown",c.onGrab(t)),c.elementGroup.appendChild(t),t})))}}catch(e){f.e(e)}finally{f.f()}c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),De(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var b=c.shape.querySelector(".a9s-inner").getBBox();return b.x,b.y,b.width,b.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&mn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(W);function Rn(e){return Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rn(e)}function _n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gn(e,t){return Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Gn(e,t)}function Tn(e,t){if(t&&("object"===Rn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Dn(e)}function Dn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nn(e){return Nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nn(e)}function Ln(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Hn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gn(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Nn(r);if(o){var n=Nn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Tn(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Ln(Dn(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new yn([e,t],r.g,r.env)})),Ln(Dn(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Ln(Dn(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),Ln(Dn(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),Ln(Dn(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),Ln(Dn(r),"onMouseUp",(function(e,t,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else{var o=r.rubberband.getBoundingClientRect(),i=o.width,a=o.height,u=r.config.minSelectionWidth||4,c=r.config.minSelectionHeight||4;i>=u||a>=c?r.rubberband.addPoint([e,t]):(r.emit("cancel"),r.stop())}})),Ln(Dn(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]);var n=r.rubberband.element;n.annotation=r.rubberband.toSelection(),r.emit("complete",n),r.stop()})),Ln(Dn(r),"createEditableShape",(function(e){return new Mn(e,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&r.undo(),"n"==e.key&&r.newPart()})),r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&_n(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);function Bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Hn.identifier="multipolygon",Hn.supports=function(e){return!1};var Xn=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Un(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.line.getAttribute("x1")," ").concat(r.line.getAttribute("y1")," ").concat(r.line.getAttribute("x2")," ").concat(r.line.getAttribute("y2"),"z"))})),Un(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.line=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," z"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&Bn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(n),!0).forEach((function(t){zn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Vn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var In=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),zn(this,"setPoints",(function(e){var t=e;o.outer.setAttribute("x1",t[0]),o.inner.setAttribute("x1",t[0]),o.outer.setAttribute("y1",t[1]),o.inner.setAttribute("y1",t[1]),t.length>2&&(o.outer.setAttribute("x2",t[2]),o.inner.setAttribute("x2",t[2]),o.outer.setAttribute("y2",t[3]),o.inner.setAttribute("y2",t[3]))})),zn(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),zn(this,"dragTo",(function(e){o.group.style.display=null,o.mousepos=e;var t,n=[].concat(function(e){if(Array.isArray(e))return Vn(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Vn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vn(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e[0],e[1]]);o.setPoints(n),o.mask.redraw()})),zn(this,"addPoint",(function(e){o.points.length<=2&&(o.points[2]=e[0],o.points[3]=e[1],o.setPoints(o.points))})),zn(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),zn(this,"newPart",(function(){o.points.push([])})),zn(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.Line=null,o.group=null})),zn(this,"toSelection",(function(){return new A(Yn(Yn({},Se(o.group,o.env.image)),{},{renderedVia:{name:"line"}}))})),this.points=t,this.env=r,this.group=document.createElementNS(i,"g"),this.Line=document.createElementNS(i,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new Xn(r.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.Line}}])&&Fn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Wn(e){return Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wn(e)}function $n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kn(e,t){return Kn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Kn(e,t)}function Jn(e,t){if(t&&("object"===Wn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Qn(e)}function Qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function er(){return er="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=tr(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},er.apply(this,arguments)}function tr(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nr(e)););return e}function nr(e){return nr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nr(e)}function rr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var or=function(e){var t=e.querySelector(".a9s-inner");return[[t.x1.baseVal,t.y1.baseVal],[t.x2.baseVal,t.y2.baseVal]]},ir=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Kn(e,t)}(u,e);var t,n,r,o,a=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=nr(r);if(o){var n=nr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Jn(this,e)});function u(e,t,n,r){var o,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),rr(Qn(c=a.call(this,e,t,n,r)),"onScaleChanged",(function(){return c.handles.map(c.scaleHandle)})),rr(Qn(c),"setPoints",(function(e){var t=e[0].x,n=e[0].y,r=e[1].x,o=e[1].y,i=c.shape.querySelector(".a9s-inner");i.setAttribute("x1",t),i.setAttribute("y1",n),i.setAttribute("x2",r),i.setAttribute("y2",o);var a=c.shape.querySelector(".a9s-outer");a.setAttribute("x1",t),a.setAttribute("y1",n),a.setAttribute("x2",r),a.setAttribute("y2",o),c.mask.redraw();var u=a.getBBox(),l=u.x,s=u.y,f=u.width,p=u.height;Ne(c.elementGroup,l,s,f,p)})),rr(Qn(c),"onGrab",(function(e){return function(t){0===t.button&&(c.grabbedElem=e,c.grabbedAt=c.getSVGPoint(t))}})),rr(Qn(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e);if(c.grabbedElem===c.shape){var r=c.shape.querySelector(".a9s-inner").getBBox(),o=r.x,i=r.y,a=r.width,u=r.height,l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-a),b=t(i,n.y-c.grabbedAt.y,f-u),y=or(c.shape).map((function(e){return{x:e[0].value+p,y:e[1].value+b}}));c.grabbedAt=n,c.setPoints(y),y.forEach((function(e,t){return c.setHandleXY(c.handles[t],e.x,e.y)})),c.emit("update",Se(c.shape,c.env.image))}else{var d=c.handles.indexOf(c.grabbedElem),h=or(c.shape).map((function(e,t){return t===d?n:{x:e[0].value,y:e[1].value}}));c.setPoints(h),c.setHandleXY(c.handles[d],n.x,n.y),c.emit("update",Se(c.shape,c.env.image))}}})),rr(Qn(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),rr(Qn(c),"updateState",(function(e){var t=we(e).getAttribute("points").split(" ").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $n(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split(",").map((function(e){return parseFloat(e.trim())})),2);return{x:t[0],y:t[1]}}));c.setPoints(t),t.forEach((function(e,t){return c.setHandleXY(c.handles[t],e.x,e.y)}))})),rr(Qn(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),er((o=Qn(c),nr(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=Oe(e),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape)),c.mask=new Xn(r.image,c.shape.querySelector(".a9s-inner")),c.containerGroup.appendChild(c.mask.element),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.setAttribute("data-id",e.id),c.elementGroup.appendChild(c.shape),c.handles=or(c.shape).map((function(e){var t=c.drawHandle(e[0].value,e[1].value);return t.addEventListener("mousedown",c.onGrab(t)),c.elementGroup.appendChild(t),t})),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),De(c.shape,e,n.formatters),c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&Zn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(W);function ar(e){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ar(e)}function ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cr(e,t){return cr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cr(e,t)}function lr(e,t){if(t&&("object"===ar(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return sr(e)}function sr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fr(e){return fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fr(e)}function pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var br=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cr(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fr(r);if(o){var n=fr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return lr(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),pr(sr(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new In([e,t],r.g,r.env)})),pr(sr(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),pr(sr(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),pr(sr(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),pr(sr(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),pr(sr(r),"onMouseUp",(function(e,t,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else{var o=r.rubberband.getBoundingClientRect();if(o.width,o.height,r.config.minSelectionWidth,r.config.minSelectionHeight,2==r.rubberband.points.length)if(r.rubberband.addPoint([e,t]),r.rubberband.points[0]==r.rubberband.points[2]&&r.rubberband.points[1]==r.rubberband.points[3])r.emit("cancel"),r.stop();else{r._isDrawing=!1;var i=r.rubberband.element;i.annotation=r.rubberband.toSelection(),r.emit("complete",i),r.stop()}}})),pr(sr(r),"createEditableShape",(function(e){return new ir(e,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&r.undo(),"n"==e.key&&r.newPart()})),r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&ur(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);br.identifier="line",br.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<line/g)};var yr=new Set(["point","circle","ellipse","freehand","line"]);const dr=function(e,t){(null!=t&&t.tools?t.tools.map((function(e){return e.toLowerCase()})):yr).forEach((function(t){"point"===t&&e.addDrawingTool(me),"circle"===t&&e.addDrawingTool(nt),"ellipse"===t&&e.addDrawingTool(Rt),"freehand"===t&&e.addDrawingTool(tn),"multipolygon"===t&&e.addDrawingTool(Hn),"line"===t&&e.addDrawingTool(br)}))}})(),r.default})()}));
//# sourceMappingURL=annotorious-selector-pack.js.map